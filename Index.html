<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ibidem: Recreación Histórica</title>
    <meta name="description" content="Asociación de recreación histórica dedicada a la reconstrucción minuciosa de la vida civil romana, indumentaria y ritos en Andalucía.">
    <link rel="icon" type="image/svg+xml" href="https://raw.githubusercontent.com/ibidemrecreacion/ibidem/main/assets/img/General/Logos/svg/Ibidem_logo_nuevo_rojo.jpg">

    <!-- LIBRERÍAS EXTERNAS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-router-dom@6/umd/react-router-dom.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- FUENTES -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Merriweather:ital,wght@0,300;0,400;0,700;1,300;1,400&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        pompeyano: '#9A2A2A',
                        pergamino: '#F5EFE3',
                        pizarra: '#2A2A2A',
                        dorado: '#B8860B',
                        'dorado-safe': '#856404'
                    },
                    fontFamily: {
                        cinzel: ['Cinzel', 'serif'],
                        merriweather: ['Merriweather', 'serif']
                    },
                    animation: {
                        'spin-slow': 'spin 3s linear infinite',
                        'ken-burns': 'kenBurns 20s ease-out infinite alternate',
                        'bounce-subtle': 'bounce 2s infinite',
                        'fade-in-up': 'fadeInUp 0.8s ease-out forwards',
                    },
                    keyframes: {
                        kenBurns: {
                            '0%': { transform: 'scale(1) translate(0, 0)' },
                            '100%': { transform: 'scale(1.15) translate(-1%, -1%)' },
                        },
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    },
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #F5EFE3;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.6' stitchTiles='stitch'/%3E%3Cfilter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.05'/%3E%3C/svg%3E");
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .text-shadow-sm { text-shadow: 0 1px 2px rgba(0,0,0,0.5); }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react-router-dom": "https://aistudiocdn.com/react-router-dom@^7.9.6",
    "react/": "https://aistudiocdn.com/react@^19.2.0/"
  }
}
</script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- IMPORTS Y UTILIDADES ---
        const { useState, useEffect, useMemo, useContext, createContext } = React;
        const { HashRouter, Routes, Route, Link, NavLink, useLocation, useParams, useNavigate } = ReactRouterDOM;

        // --- ICONOS ---
        const Icon = ({ path, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d={path} /></svg>
        );
        const Icons = {
            Menu: "M4 12h16M4 6h16M4 18h16", 
            X: "M18 6L6 18M6 6l12 12", 
            Mail: "M4 4h16c2 0 2 2 2 2v12c0 2-2 2-2 2H4c-2 0-2-2-2-2V6c0-2 2-2 2-2zM22 6l-10 7L2 6",
            ArrowLeft: "M19 12H5 M12 19l-7-7 7-7", 
            ChevronRight: "M9 18l6-6-6-6", 
            ChevronLeft: "M15 18l-6-6 6-6", 
            Camera: "M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z M12 13a4 4 0 1 0 0-8 4 4 0 0 0 0 8",
            MapPin: "M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z M12 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6",
            Facebook: "M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z",
            Instagram: "M15 2h-6a7 7 0 0 0-7 7v6a7 7 0 0 0 7 7h6a7 7 0 0 0 7-7V9a7 7 0 0 0-7-7z M12 16a4 4 0 1 0 0-8 4 4 0 0 0 0 8z M17.5 6.5h.01",
        };

        // --- CONTEXTO DE DATOS ---
        const DataContext = createContext({ data: null, loading: true, error: null });
        const DataProvider = ({ children }) => {
            const [data, setData] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);

            useEffect(() => {
                fetch('data.json')
                    .then(res => {
                        if (!res.ok) throw new Error("No se encontró el archivo data.json");
                        return res.json();
                    })
                    .then(d => { setData(d); setLoading(false); })
                    .catch(e => { console.error(e); setError(e.message); setLoading(false); });
            }, []);

            return <DataContext.Provider value={{ data, loading, error }}>{children}</DataContext.Provider>;
        };
        const useData = () => useContext(DataContext);

        // --- COMPONENTES UI ---

        const SectionHeader = ({ title, subtitle }) => (
            <div className="text-center mb-12 md:mb-16 pt-8 animate-fade-in-up">
                {subtitle && <span className="block font-cinzel text-dorado-safe text-sm tracking-[0.3em] uppercase mb-3 font-bold">{subtitle}</span>}
                <h2 className="font-cinzel text-3xl md:text-5xl font-bold text-pizarra leading-tight inline-block relative px-6">
                    {title}
                    <span className="absolute bottom-0 left-1/2 -translate-x-1/2 w-16 h-1 bg-pompeyano rounded mt-2"></span>
                </h2>
            </div>
        );

        const MobileStoryCard = ({ image, category, date, title, subtitle, description, linkTo, linkLabel, isNext, isLast }) => (
            <div className="snap-start h-full w-full relative flex flex-col justify-end p-6 border-b border-gray-800 overflow-hidden group">
                <div className="absolute inset-0 z-0 bg-pizarra">
                    <img src={image} alt={title} className="w-full h-full object-cover opacity-60 animate-ken-burns will-change-transform" onError={(e) => e.target.src='https://placehold.co/600x800/2A2A2A/9A2A2A?text=IBIDEM'}/>
                    <div className="absolute inset-0 bg-gradient-to-t from-black via-black/40 to-black/10"></div>
                </div>
                <div className="relative z-10 text-white pb-20 flex flex-col h-full justify-end">
                    <div className="flex justify-between items-start mb-3 animate-fade-in-up">
                        <div className="flex gap-2">
                            {category && <span className="bg-dorado/90 backdrop-blur-sm text-white text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider shadow-sm">{category}</span>}
                            {date && <span className="bg-pompeyano/90 backdrop-blur-sm text-white text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider shadow-sm">{date}</span>}
                        </div>
                        {isNext && <span className="bg-white text-pompeyano text-[10px] font-bold px-2 py-1 rounded-full animate-pulse shadow-lg">PRÓXIMO</span>}
                    </div>
                    <h2 className="font-cinzel text-3xl font-bold leading-tight mb-2 shadow-black drop-shadow-lg text-shadow-sm">{title}</h2>
                    {subtitle && <div className="flex items-center text-gray-300 text-sm mb-4 font-merriweather italic"><Icon path={Icons.MapPin} size={14} className="mr-1 text-dorado"/> {subtitle}</div>}
                    <p className="text-gray-200 text-sm line-clamp-4 mb-6 leading-relaxed opacity-90 font-light">{description}</p>
                    <Link to={linkTo} className="block w-full text-center bg-white/10 backdrop-blur-md border border-white/40 hover:bg-white hover:text-pompeyano hover:border-white text-white font-cinzel font-bold py-3 rounded-lg transition-all duration-300 shadow-lg active:scale-95">{linkLabel}</Link>
                    {!isLast && <div className="absolute bottom-6 left-1/2 -translate-x-1/2 animate-bounce-subtle opacity-70"><Icon path={Icons.ChevronLeft} size={24} className="-rotate-90 text-white"/></div>}
                </div>
            </div>
        );

        // --- PÁGINAS ---

        const Home = () => {
            const { data } = useData();
            if (!data) return null;
            return (
                <div className="animate-fade-in-up">
                    <section className="relative h-[60vh] md:h-[70vh] w-full bg-cover bg-center rounded-xl overflow-hidden shadow-2xl mb-16 group" style={{ backgroundImage: `url(${data.general.heroImageHome})` }}>
                        <div className="absolute inset-0 bg-gradient-to-t from-pizarra via-pizarra/40 to-transparent opacity-90 transition-opacity duration-1000 group-hover:opacity-80"></div>
                        <div className="absolute bottom-8 left-6 md:bottom-16 md:left-12 max-w-3xl pr-4">
                            <div className="border-l-4 border-dorado pl-6"><h1 className="font-merriweather text-xl md:text-3xl italic text-pergamino leading-relaxed shadow-black drop-shadow-md">{data.home.heroTitle}</h1></div>
                        </div>
                    </section>
                    <section className="max-w-4xl mx-auto text-center mb-16 px-4">
                        <p className="text-xl md:text-2xl text-pizarra leading-relaxed font-light">{data.home.intro}</p>
                        <div className="mt-8 w-24 h-1 bg-dorado mx-auto rounded-full"></div>
                    </section>
                    <SectionHeader title="NOSTRA FUNDAMENTA" subtitle="Nuestros Pilares" />
                    <div className="grid md:grid-cols-3 gap-8 mb-16 px-4">
                        {data.home.pilares.map((pilar, index) => (
                            <article key={index} className="bg-white p-8 rounded-lg shadow-lg border-t-4 border-dorado hover:-translate-y-2 hover:shadow-2xl transition-all duration-300 flex flex-col">
                                <h3 className="font-cinzel text-xl font-bold text-pompeyano mb-4">{pilar.title}</h3>
                                <p className="text-gray-700 mb-6 text-justify leading-relaxed flex-grow">{pilar.text}</p>
                                <Link to={`/${pilar.linkTo}`} className="text-dorado-safe font-bold text-xs uppercase tracking-widest hover:text-pompeyano flex items-center gap-2 group self-start">Saber más <Icon path={Icons.ChevronRight} size={14} className="group-hover:translate-x-1 transition-transform"/></Link>
                            </article>
                        ))}
                    </div>
                </div>
            );
        };

        const Nostri = () => {
            const { data } = useData();
            if (!data) return null;
            return (
                <div className="animate-fade-in-up">
                    <SectionHeader title="NOSTRI" subtitle="Nuestra Historia" />
                    <div className="grid lg:grid-cols-12 gap-12 max-w-6xl mx-auto px-4">
                        <article className="lg:col-span-7 bg-white p-8 md:p-12 rounded-lg shadow-xl border-l-4 border-pompeyano h-fit">
                            {data.nostri.mainText.split('\n').map((p, i) => (p.trim() && <p key={i} className="text-lg text-justify leading-relaxed mb-6 last:mb-0 text-gray-700">{p}</p>))}
                        </article>
                        <aside className="lg:col-span-5">
                            <div className="bg-white p-8 rounded-xl shadow-xl sticky top-24">
                                <div className="flex flex-col items-center text-center mb-6">
                                    <img src={data.nostri.founder.image} alt={data.nostri.founder.name} className="w-40 h-40 rounded-full border-4 border-dorado object-cover shadow-lg mb-4 hover:scale-105 transition-transform" />
                                    <h4 className="font-cinzel text-2xl font-bold text-pizarra">{data.nostri.founder.name}</h4>
                                    <span className="bg-dorado text-white text-xs px-3 py-1 rounded font-cinzel mt-2 inline-block mb-1 tracking-wider shadow-sm">FUNDADOR</span>
                                    <p className="text-pompeyano font-cinzel text-sm tracking-widest font-bold">{data.nostri.founder.years}</p>
                                </div>
                                <div className="w-full h-px bg-gray-200 mb-6"></div>
                                <p className="text-gray-600 italic text-justify leading-relaxed text-sm">{data.nostri.founder.desc}</p>
                            </div>
                        </aside>
                    </div>
                </div>
            );
        };

        const Fasti = () => {
            const { data } = useData();
            const { future, groupedPast, years, allEventsSorted } = useMemo(() => {
                if (!data) return { future: [], groupedPast: {}, years: [], allEventsSorted: [] };
                const parseDate = (dateStr) => {
                    if(!dateStr) return new Date(0);
                    try {
                        const months = {"enero": 0, "febrero": 1, "marzo": 2, "abril": 3, "mayo": 4, "junio": 5, "julio": 6, "agosto": 7, "septiembre": 8, "octubre": 9, "noviembre": 10, "diciembre": 11};
                        const clean = dateStr.toLowerCase().replace(/de /g, '').replace(/,/g, '').split(' ');
                        let m = -1, d = 1, y = new Date().getFullYear();
                        clean.forEach(part => {
                            if (months[part] !== undefined) m = months[part]; else if (parseInt(part) > 31) y = parseInt(part); else if (!isNaN(parseInt(part))) d = parseInt(part);
                        });
                        return m === -1 ? new Date(0) : new Date(y, m, d);
                    } catch (e) { return new Date(0); }
                };
                const all = [...(data.fasti.upcoming || []), ...(data.fasti.past || [])];
                const now = new Date(); now.setHours(0,0,0,0);
                const future = [], past = [];
                all.forEach(e => { const d = parseDate(e.date); if(d >= now) future.push(e); else past.push(e); });
                future.sort((a,b) => parseDate(a.date) - parseDate(b.date));
                past.sort((a,b) => parseDate(b.date) - parseDate(a.date));
                const allEventsSorted = [...future, ...past];
                const grouped = {};
                past.forEach(e => { const y = parseDate(e.date).getFullYear() || "Antiguo"; if(!grouped[y]) grouped[y] = []; grouped[y].push(e); });
                return { future, groupedPast: grouped, years: Object.keys(grouped).sort((a,b) => b-a), allEventsSorted };
            }, [data]);

            if (!data) return null;

            // Desktop Card Component
            const EventCard = ({ event, isFuture }) => {
                const album = data.imagina.find(a => a.id === event.id);
                const displayImage = event.coverImage || (album?.coverImage) || (album?.images?.[0]?.src);
                return (
                    <Link to={`/imagina/${event.id}`} className={`block bg-white rounded-lg overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 group h-full flex flex-col ${isFuture ? 'border-t-4 border-pompeyano transform hover:-translate-y-1' : 'border-l-4 border-dorado'}`}>
                        <div className="h-48 overflow-hidden relative bg-gray-100">
                            {displayImage ? <img src={displayImage} alt={event.title} className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" /> : <div className="w-full h-full flex items-center justify-center text-gray-400"><Icon path={Icons.Camera} size={48} className="opacity-20"/></div>}
                            <div className="absolute inset-0 bg-pompeyano/60 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center backdrop-blur-sm"><span className="text-white font-cinzel font-bold tracking-widest text-sm border-2 border-white px-4 py-2 rounded">VER GALERÍA</span></div>
                        </div>
                        <div className="p-5 flex-grow flex flex-col">
                            <div className="flex items-center gap-2 mb-3"><span className={`text-[10px] font-bold px-2 py-0.5 rounded uppercase tracking-wide ${isFuture ? 'bg-pompeyano text-white' : 'bg-gray-200 text-gray-600'}`}>{isFuture ? 'PRÓXIMO' : event.date}</span></div>
                            <h3 className="font-cinzel text-xl font-bold text-pizarra mb-2 leading-tight group-hover:text-pompeyano transition-colors">{event.title}</h3>
                            <div className="flex items-center text-gray-500 text-sm mb-4"><Icon path={Icons.MapPin} size={14} className="mr-1 text-dorado-safe"/> {event.location.locality}</div>
                            <p className="text-gray-700 text-sm leading-relaxed mb-4 line-clamp-3">{event.desc}</p>
                            <div className="mt-auto flex flex-wrap gap-1">{event.tags && event.tags.slice(0,3).map((t, i) => (<span key={i} className="text-[9px] bg-gray-50 text-gray-500 px-2 py-1 rounded border border-gray-100 uppercase tracking-wide">{t}</span>))}</div>
                        </div>
                    </Link>
                );
            };

            return (
                <div className="animate-fade-in-up">
                    <div className="hidden md:block pb-12">
                        <SectionHeader title="FASTI" subtitle="Calendario" />
                        {future.length > 0 && (
                            <div className="max-w-6xl mx-auto px-4 mb-20">
                                <div className="flex items-center gap-4 mb-8"><h3 className="font-cinzel text-2xl font-bold text-pompeyano">Proxima Eventa</h3><div className="h-px bg-pompeyano/20 flex-grow"></div></div>
                                <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-8">{future.map(e => <EventCard key={e.id} event={e} isFuture={true} />)}</div>
                            </div>
                        )}
                        <div className="max-w-5xl mx-auto px-4 relative">
                            <div className="text-center mb-16"><h3 className="font-cinzel text-2xl font-bold text-pizarra inline-block border-b-2 border-dorado pb-2 px-8">Acta Praeterita</h3></div>
                            <div className="absolute left-[31px] md:left-1/2 top-32 bottom-0 w-1 bg-gray-200 md:-translate-x-1/2 rounded-full"></div>
                            <div className="space-y-20">
                                {years.map(year => (
                                    <div key={year} className="relative">
                                        <div className="flex md:justify-center mb-10 relative z-10 pl-2 md:pl-0"><span className="bg-pizarra text-pergamino font-cinzel font-bold text-xl px-6 py-2 rounded-full shadow-lg border-4 border-dorado ring-4 ring-white">{year}</span></div>
                                        <div className="relative space-y-16 md:space-y-24">
                                            {groupedPast[year].map((evt, idx) => (
                                                <div key={evt.id} className={`md:flex items-center justify-between w-full group ${idx % 2 === 0 ? 'md:flex-row-reverse' : ''}`}>
                                                    <div className="hidden md:block md:w-5/12"></div>
                                                    <div className="absolute left-[31px] md:left-1/2 w-5 h-5 bg-white border-4 border-pompeyano rounded-full shadow transform -translate-x-1/2 z-10 md:group-hover:scale-150 md:group-hover:border-dorado transition-all duration-300"></div>
                                                    <div className="pl-16 md:pl-0 w-full md:w-5/12 relative"><EventCard event={evt} isFuture={false} /></div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                    {/* MOBILE STORY MODE */}
                    <div className="md:hidden h-[calc(100dvh-7rem)] overflow-y-scroll snap-y snap-mandatory scroll-smooth hide-scrollbar bg-pizarra">
                        {allEventsSorted.map((evt, idx) => {
                            const album = data.imagina.find(a => a.id === evt.id);
                            const displayImage = evt.coverImage || (album?.coverImage) || (album?.images?.[0]?.src);
                            return <MobileStoryCard key={idx} id={evt.id} image={displayImage} date={evt.date} title={evt.title} subtitle={evt.location.locality} description={evt.desc} linkTo={`/imagina/${evt.id}`} linkLabel="VER GALERÍA" isNext={evt.id === future[0]?.id} isLast={idx === allEventsSorted.length - 1} />;
                        })}
                    </div>
                </div>
            );
        };

        const Tabularium = () => {
            const { data } = useData();
            const [filter, setFilter] = useState('TODOS');
            if (!data) return null;
            const categories = ['TODOS', ...new Set(data.tabularium.map(a => a.category))];
            const filtered = data.tabularium.filter(a => filter === 'TODOS' || a.category === filter);

            return (
                <div className="animate-fade-in-up">
                     {/* DESKTOP VIEW */}
                    <div className="hidden md:block">
                        <SectionHeader title="TABULARIUM" subtitle="Archivo y Blog" />
                        <div className="flex justify-center flex-wrap gap-3 mb-12 px-4">
                            {categories.map(c => (
                                <button key={c} onClick={() => setFilter(c)} className={`px-5 py-2 rounded-full font-cinzel text-xs font-bold tracking-wider border transition-all duration-300 ${filter === c ? 'bg-pompeyano text-white border-pompeyano shadow-md transform scale-105' : 'bg-white text-gray-500 border-gray-200 hover:border-pompeyano hover:text-pompeyano'}`}>{c.toUpperCase()}</button>
                            ))}
                        </div>
                        <div className="grid md:grid-cols-2 gap-8 max-w-6xl mx-auto px-4">
                            {filtered.map(art => (
                                <article key={art.id} className="bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-2xl transition-all duration-300 flex flex-col group border border-gray-100">
                                    <div className="h-56 overflow-hidden relative"><img src={art.img} className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" alt={art.title} /><div className="absolute top-4 right-4 bg-white/90 backdrop-blur text-xs font-bold px-3 py-1 rounded shadow text-pizarra uppercase tracking-wide">{art.category}</div></div>
                                    <div className="p-8 flex-col flex flex-grow">
                                        <span className="text-xs text-gray-400 font-cinzel mb-2 block">{art.date}</span>
                                        <h3 className="font-cinzel text-xl font-bold text-pizarra mb-3 leading-snug group-hover:text-pompeyano transition-colors">{art.title}</h3>
                                        <p className="text-gray-600 text-sm mb-6 line-clamp-3 text-justify leading-relaxed flex-grow">{art.summary}</p>
                                        <Link to={`/tabularium/${art.id}`} className="text-pompeyano font-bold text-xs uppercase tracking-widest hover:text-dorado-safe flex items-center mt-auto group/link">Leer Artículo <Icon path={Icons.ArrowLeft} size={14} className="ml-2 rotate-180 group-hover/link:translate-x-1 transition-transform"/></Link>
                                    </div>
                                </article>
                            ))}
                        </div>
                    </div>
                     {/* MOBILE STORY MODE */}
                    <div className="md:hidden h-[calc(100dvh-7rem)] overflow-y-scroll snap-y snap-mandatory scroll-smooth hide-scrollbar bg-pizarra">
                        {filtered.map((art, idx) => <MobileStoryCard key={idx} id={art.id} image={art.img} category={art.category} date={art.date} title={art.title} description={art.summary} linkTo={`/tabularium/${art.id}`} linkLabel="LEER ARTÍCULO" isLast={idx === filtered.length - 1} />)}
                    </div>
                </div>
            );
        };

        const ArticleView = () => {
            const { id } = useParams();
            const { data } = useData();
            const art = data?.tabularium.find(a => a.id.toString() === id);
            if (!art) return <div className="text-center py-20">Artículo no encontrado.</div>;
            return (
                <article className="max-w-3xl mx-auto bg-white rounded-xl shadow-2xl my-8 animate-fade-in-up overflow-hidden">
                    <div className="h-64 md:h-96 w-full relative">
                        <img src={art.img} className="w-full h-full object-cover" alt={art.title} />
                        <div className="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
                        <div className="absolute bottom-6 left-6 md:bottom-10 md:left-10 text-white">
                            <span className="bg-dorado text-xs font-bold px-3 py-1 rounded uppercase tracking-widest mb-2 inline-block shadow-sm">{art.category}</span>
                            <h1 className="font-cinzel text-2xl md:text-4xl font-bold leading-tight shadow-black drop-shadow-md max-w-2xl">{art.title}</h1>
                        </div>
                    </div>
                    <div className="p-8 md:p-12">
                        <Link to="/tabularium" className="inline-flex items-center text-gray-500 hover:text-pompeyano transition-colors mb-8 font-bold text-sm uppercase tracking-wide group"><Icon path={Icons.ArrowLeft} size={18} className="mr-2 group-hover:-translate-x-1 transition-transform"/> Volver al Archivo</Link>
                        <div className="flex items-center justify-between border-b border-gray-100 pb-6 mb-8 text-sm text-gray-500 font-merriweather italic"><span>Por <strong className="text-pizarra">{art.author}</strong></span><span>{art.date}</span></div>
                        <div className="prose prose-lg max-w-none text-gray-800 font-merriweather">
                            {art.intro && <p className="text-xl leading-relaxed text-gray-600 border-l-4 border-pompeyano pl-6 italic mb-10">{art.intro}</p>}
                            {art.sections?.map((section, idx) => (
                                <div key={idx} className="mb-10"><h2 className="font-cinzel text-2xl font-bold text-pompeyano mb-4 mt-8">{section.title}</h2><p className="text-justify leading-loose">{section.content}</p>{section.image && <figure className="my-8"><img src={section.image} alt="" className="w-full rounded-lg shadow-md" /></figure>}</div>
                            ))}
                        </div>
                        {art.bibliography && (
                            <div className="mt-16 bg-gray-50 p-6 rounded-lg border border-gray-100"><h3 className="font-cinzel text-lg font-bold text-gray-400 mb-4 uppercase tracking-widest">Fontes (Bibliografía)</h3><ul className="space-y-3">{art.bibliography.map((item, i) => <li key={i} className="text-sm text-gray-600 pl-4 border-l-2 border-dorado/30" dangerouslySetInnerHTML={{ __html: item.replace(/\*(.*?)\*/g, '<em>$1</em>') }}></li>)}</ul></div>
                        )}
                    </div>
                </article>
            );
        };

        const Imagina = () => {
            const { data } = useData();
            if (!data) return null;
            const albums = useMemo(() => {
                const combined = [...data.imagina];
                const events = [...(data.fasti.upcoming||[]), ...(data.fasti.past||[])];
                events.forEach(e => {
                    if (!combined.find(a => a.id === e.id) && (e.coverImage)) {
                        combined.push({ id: e.id, eventTitle: e.title, date: e.date, location: e.location, coverImage: e.coverImage, images: [{ src: e.coverImage }] });
                    }
                });
                return combined;
            }, [data]);

            return (
                <div className="animate-fade-in-up px-4">
                    <SectionHeader title="IMAGINA" subtitle="Galería Fotográfica" />
                    <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-7xl mx-auto">
                        {albums.map(alb => (
                            <Link key={alb.id} to={`/imagina/${alb.id}`} className="block group bg-white rounded-lg overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 hover:-translate-y-2 border-b-4 border-transparent hover:border-dorado">
                                <div className="h-64 overflow-hidden relative">
                                    <img src={alb.coverImage} className="w-full h-full object-cover transition duration-700 group-hover:scale-110" alt={`Portada de ${alb.eventTitle}`} />
                                    <div className="absolute inset-0 bg-pompeyano/80 opacity-0 group-hover:opacity-90 transition duration-300 flex flex-col items-center justify-center text-white p-4 text-center"><Icon path={Icons.Camera} size={48} className="mb-2"/><span className="font-cinzel font-bold tracking-widest">VER {alb.images?.length || 0} FOTOS</span></div>
                                </div>
                                <div className="p-6 text-center">
                                    <h3 className="font-cinzel text-lg font-bold text-pizarra truncate mb-1">{alb.eventTitle}</h3>
                                    <div className="w-12 h-1 bg-dorado mx-auto rounded my-3 opacity-50"></div>
                                    <p className="text-xs text-gray-500 font-bold uppercase tracking-widest">{alb.date}</p>
                                </div>
                            </Link>
                        ))}
                    </div>
                </div>
            );
        };

        const AlbumView = () => {
            const { id } = useParams();
            const { data } = useData();
            const [lightboxIndex, setLightboxIndex] = useState(null);
            
            const albums = useMemo(() => {
                 if (!data) return [];
                 const combined = [...data.imagina];
                 const events = [...(data.fasti.upcoming||[]), ...(data.fasti.past||[])];
                 events.forEach(e => {
                     if (!combined.find(a => a.id === e.id) && (e.coverImage)) combined.push({ id: e.id, eventTitle: e.title, date: e.date, location: e.location, coverImage: e.coverImage, images: [{ src: e.coverImage }] });
                 });
                 return combined;
            }, [data]);

            const selected = albums.find(a => a.id.toString() === id);
            if (!selected) return <div className="text-center py-20">Álbum no encontrado.</div>;

            const nextImage = (e) => { e.stopPropagation(); if (lightboxIndex < selected.images.length - 1) setLightboxIndex(lightboxIndex + 1); };
            const prevImage = (e) => { e.stopPropagation(); if (lightboxIndex > 0) setLightboxIndex(lightboxIndex - 1); };

            return (
                <div className="animate-fade-in-up px-4">
                    <Link to="/imagina" className="flex items-center text-gray-500 hover:text-pompeyano transition font-bold text-sm mb-8 uppercase tracking-wide group"><Icon path={Icons.ArrowLeft} size={18} className="mr-2 group-hover:-translate-x-1 transition-transform"/> Volver a Galerías</Link>
                    <SectionHeader title={selected.eventTitle} subtitle={selected.date} />
                    <div className="columns-1 md:columns-2 lg:columns-3 gap-6 space-y-6 max-w-7xl mx-auto">
                        {selected.images.map((img, i) => (
                            <div key={i} className="break-inside-avoid rounded-lg overflow-hidden shadow-md hover:shadow-xl transition-all duration-300 cursor-pointer group bg-white" onClick={() => setLightboxIndex(i)}>
                                <img src={img.src} alt={img.caption || ""} className="w-full h-auto transform transition-transform duration-500 group-hover:scale-105" loading="lazy" />
                                {img.caption && <div className="p-3 bg-white text-xs text-center italic text-gray-600 border-t border-gray-100">{img.caption}</div>}
                            </div>
                        ))}
                    </div>
                    {lightboxIndex !== null && (
                        <div className="fixed inset-0 z-50 bg-black/95 flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in-up" onClick={() => setLightboxIndex(null)}>
                            <button className="absolute top-6 right-6 text-white/70 hover:text-white transition"><Icon path={Icons.X} size={40} /></button>
                            <button className={`absolute left-4 md:left-8 text-white/70 hover:text-white transition ${lightboxIndex === 0 ? 'opacity-20 cursor-default' : ''}`} onClick={prevImage}><Icon path={Icons.ChevronLeft} size={48} /></button>
                            <div className="max-w-5xl max-h-[85vh] relative" onClick={e => e.stopPropagation()}>
                                <img src={selected.images[lightboxIndex].src} alt="" className="max-h-[80vh] w-auto mx-auto rounded shadow-2xl"/>
                                {selected.images[lightboxIndex].caption && <p className="text-center text-gray-300 mt-4 font-cinzel text-sm tracking-wide">{selected.images[lightboxIndex].caption}</p>}
                                <p className="text-center text-gray-500 mt-2 text-xs">{lightboxIndex + 1} / {selected.images.length}</p>
                            </div>
                            <button className={`absolute right-4 md:right-8 text-white/70 hover:text-white transition ${lightboxIndex === selected.images.length - 1 ? 'opacity-20 cursor-default' : ''}`} onClick={nextImage}><Icon path={Icons.ChevronRight} size={48} /></button>
                        </div>
                    )}
                </div>
            );
        };

        // --- LAYOUT PRINCIPAL ---

        const Layout = ({ children }) => {
            const { data } = useData();
            const [mobileMenu, setMobileMenu] = useState(false);
            const [legalModal, setLegalModal] = useState(null);
            const [scrollProgress, setScrollProgress] = useState(0);
            const [showScrollTop, setShowScrollTop] = useState(false);
            const location = useLocation();

            useEffect(() => { window.scrollTo(0, 0); }, [location.pathname]);
            useEffect(() => {
                const handleScroll = () => {
                    const t = window.scrollY;
                    const h = document.documentElement.scrollHeight - document.documentElement.clientHeight;
                    if (h > 0) setScrollProgress((t / h) * 100);
                    setShowScrollTop(t > 400);
                };
                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            if (!data) return null;
            const navLinkClass = ({ isActive }) => `font-cinzel font-bold tracking-widest transition-all duration-300 ${isActive ? 'text-pompeyano border-b-2 border-pompeyano scale-105' : 'text-pizarra hover:text-pompeyano'}`;
            const navItems = [{r:'/',l:'DOMUS'},{r:'/nostri',l:'NOSTRI'},{r:'/fasti',l:'FASTI'},{r:'/imagina',l:'IMAGINA'},{r:'/tabularium',l:'TABULARIUM'}];

            return (
                <div className="flex flex-col min-h-screen font-merriweather text-pizarra selection:bg-pompeyano selection:text-white relative">
                    <div className="fixed top-0 left-0 h-1.5 bg-pompeyano z-50 transition-all duration-100 ease-out shadow-[0_0_10px_rgba(154,42,42,0.5)]" style={{ width: `${scrollProgress}%` }}></div>
                    
                    <header className="sticky top-0 z-40 bg-pergamino/95 backdrop-blur-md border-b border-dorado/20 shadow-sm transition-all h-20 md:h-28 flex items-center">
                        <div className="container mx-auto px-4 flex justify-between items-center w-full">
                            <Link to="/" className="group relative z-50"><img src={data.general.logoUrl} alt="Ibidem Logo" className="h-16 md:h-24 w-auto transition-transform duration-300 group-hover:scale-105 drop-shadow-md" /></Link>
                            <nav className="hidden md:flex space-x-8">{navItems.map(i => <NavLink key={i.r} to={i.r} className={navLinkClass}>{i.l}</NavLink>)}</nav>
                            <button className="md:hidden text-pompeyano p-2 focus:outline-none" onClick={() => setMobileMenu(true)}><Icon path={Icons.Menu} size={32} /></button>
                        </div>
                    </header>

                    <div className={`fixed inset-0 z-50 bg-pompeyano transition-transform duration-500 flex flex-col items-center justify-center space-y-8 ${mobileMenu ? 'translate-x-0' : 'translate-x-full'}`}>
                        <button onClick={() => setMobileMenu(false)} className="absolute top-6 right-6 text-white p-2 hover:rotate-90 transition-transform duration-300"><Icon path={Icons.X} size={32} /></button>
                        <img src={data.general.logoUrl} alt="Logo" className="h-28 w-auto mb-8 brightness-0 invert opacity-90" />
                        {navItems.map(i => <NavLink key={i.r} to={i.r} className="text-white font-cinzel text-2xl font-bold tracking-widest hover:text-dorado transition-colors" onClick={() => setMobileMenu(false)}>{i.l}</NavLink>)}
                    </div>

                    <main className="flex-grow container mx-auto md:py-12 relative z-10 min-h-[60vh]">{children}</main>

                    <footer className="bg-pizarra text-pergamino border-t-4 border-dorado relative z-20 py-8 md:py-12">
                        <div className="container mx-auto px-4 text-center">
                            {/* SOCIAL ICONS (Visibles en móvil y escritorio) */}
                            <div className="flex justify-center gap-6 md:gap-8 mb-6 md:mb-8">
                                {[
                                    { href: data.general.facebook, icon: Icons.Facebook, label: 'Facebook' },
                                    { href: data.general.instagram, icon: Icons.Instagram, label: 'Instagram' },
                                    { href: `mailto:${data.general.email}`, icon: Icons.Mail, label: 'Email' }
                                ].map((social, idx) => (
                                    <a key={idx} href={social.href} target="_blank" rel="noopener noreferrer" aria-label={social.label} className="text-pergamino hover:text-dorado transition-transform hover:scale-110 hover:-translate-y-1 p-2 border border-transparent hover:border-dorado/30 rounded-full">
                                        <Icon path={social.icon} size={28} />
                                    </a>
                                ))}
                            </div>
                            <div className="flex flex-col md:flex-row justify-center items-center gap-3 md:gap-4 text-[10px] md:text-xs uppercase tracking-widest font-cinzel text-gray-400 mb-4">
                                <div className="flex gap-4"><button onClick={() => setLegalModal('legal')} className="hover:text-dorado transition">Aviso Legal</button><span>|</span><button onClick={() => setLegalModal('accesibility')} className="hover:text-dorado transition">Accesibilidad</button></div>
                            </div>
                            <p className="font-cinzel text-[10px] md:text-xs text-gray-500 tracking-widest">&copy; {new Date().getFullYear()} IBIDEM RECREATIO.</p>
                        </div>
                    </footer>

                    <button onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })} className={`fixed bottom-6 right-6 z-40 bg-pompeyano text-white p-3 rounded-full shadow-xl border-2 border-white hover:bg-dorado transition-all duration-300 transform ${showScrollTop ? 'translate-y-0 opacity-100' : 'translate-y-20 opacity-0'}`} aria-label="Volver arriba"><Icon path={Icons.ChevronLeft} size={24} className="rotate-90" /></button>

                    {legalModal && (
                        <div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 backdrop-blur-sm" onClick={() => setLegalModal(null)}>
                            <div className="bg-white rounded-lg shadow-2xl p-6 md:p-10 max-w-2xl w-full max-h-[90vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                                <div className="flex justify-between items-center border-b pb-4 mb-6"><h3 className="font-cinzel text-2xl font-bold text-pompeyano">{legalModal === 'legal' ? 'Aviso Legal' : 'Accesibilidad'}</h3><button onClick={() => setLegalModal(null)} className="text-gray-400 hover:text-pizarra"><Icon path={Icons.X} size={24}/></button></div>
                                <div className="prose prose-stone max-w-none text-gray-700">
                                    {legalModal === 'legal' ? (
                                        <>
                                            <p className="mb-4">En cumplimiento con la LSSI:</p>
                                            <ul className="list-disc pl-5 mb-4"><li><strong>Titular:</strong> Asociación El triunfo de Baco</li><li><strong>NIF:</strong> G14974489</li><li><strong>Domicilio:</strong> Puente Genil (Córdoba)</li><li><strong>Contacto:</strong> {data.general.email}</li></ul>
                                            <p>Contenido propiedad de Ibidem Recreación Histórica.</p>
                                        </>
                                    ) : ( <p>Ibidem cumple con directrices WCAG 2.1.</p> )}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const App = () => {
            return (
                <DataProvider>
                    <HashRouter>
                        <Layout>
                            <Routes>
                                <Route path="/" element={<Home />} />
                                <Route path="/nostri" element={<Nostri />} />
                                <Route path="/fasti" element={<Fasti />} />
                                <Route path="/tabularium" element={<Tabularium />} />
                                <Route path="/tabularium/:id" element={<ArticleView />} />
                                <Route path="/imagina" element={<Imagina />} />
                                <Route path="/imagina/:id" element={<AlbumView />} />
                                <Route path="*" element={<Home />} />
                            </Routes>
                        </Layout>
                    </HashRouter>
                </DataProvider>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>